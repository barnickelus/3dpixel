<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Genesis Evolution â€” build 0724</title>
<style>
    html,body{margin:0;height:100%;overflow:hidden;background:#000;}
    #ui{position:absolute;top:10px;left:10px;color:#fff;font-family:sans-serif;pointer-events:none}
    #radar{width:80px;height:80px;border:2px solid #0f0;border-radius:50%;margin-top:6px;display:none}
    #pauseBtn{position:absolute;top:10px;right:10px;padding:6px 12px;
              background:#222;color:#fff;border:1px solid #555;cursor:pointer}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="ui">
  <div id="score">Score 0</div>
  <div id="frenzy"> </div>
  <div id="radar"></div>
</div>
<button id="pauseBtn">Pause</button>

<script>
/* ---------- core helpers ---------- */
const rand = n => Math.random()*n;
const lerp = (a,b,t)=>a+(b-a)*t;
const TWO_PI = Math.PI*2;

/* ---------- game constants ---------- */
const canvas = document.getElementById('game'),
      ctx     = canvas.getContext('2d');

let W,H,paused=false;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight}
addEventListener('resize',resize);resize();

/* ---------- entities ---------- */
class Entity{
  constructor(x,y,r,mass,type){
    this.x=x;this.y=y;this.r=r;this.mass=mass;this.type=type;
    this.vx=0;this.vy=0;
    if(type==='spectre'){this.color='#88f';}
    if(type==='revenant'){this.color='#f08';}
  }
  draw(){
    ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,TWO_PI);
    ctx.fillStyle=this.color||'#fff';ctx.fill();
  }
  update(){this.x+=this.vx;this.y+=this.vy;}
}

const player = {x:0,y:0,r:12,mass:30,speed:2,baseSpeed:2,
                vx:0,vy:0,color:'#0f0'};

let opponents=[],pickups=[];

/* ---------- radar letters ---------- */
function spawnRadarLetters(){
  const pad=400; const positions=[
    [-pad,0],[pad,0],[0,-pad],[0,pad]
  ];
  positions.forEach(([dx,dy])=>{
    pickups.push({x:player.x+dx,y:player.y+dy,char:'R',glow:1});
  });
}
spawnRadarLetters();

/* ---------- perfect frenzy ---------- */
let frenzyTime=0,frenzyDur=10,perfectFrenzy=false;

/* ---------- spectre / revenant counters ---------- */
let spectresEaten=0;

/* ---------- controls ---------- */
let keys={};addEventListener('keydown',e=>keys[e.key]=1);
addEventListener('keyup',e=>keys[e.key]=0);

/* ---------- loop ---------- */
function loop(){
  if(!paused) update();
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* ---------- update ---------- */
function update(){
  /* movement */
  let ax=(keys['ArrowRight']?1:0)-(keys['ArrowLeft']?1:0);
  let ay=(keys['ArrowDown']?1:0)-(keys['ArrowUp']?1:0);
  const mag=Math.hypot(ax,ay)||1;
  player.vx= (ax/mag)*player.speed;
  player.vy= (ay/mag)*player.speed;
  player.x+=player.vx;
  player.y+=player.vy;

  /* decay test */
  if(!perfectFrenzy) player.mass-=0.003;

  /* frenzy countdown */
  if(frenzyTime>0){frenzyTime-=0.016;if(frenzyTime<=0) perfectFrenzy=false;}

  /* opponents update */
  opponents.forEach(o=>{
    if(o.type==='hoppy'){
      if(Math.random()<0.02) { // small hops
         let ang=rand(TWO_PI);o.vx=Math.cos(ang)*1.2;o.vy=Math.sin(ang)*1.2;
      }
    }else if(o.type==='spectre'){
      // darting
      if(Math.random()<0.05){
        let ang=Math.atan2(player.y-o.y,player.x-o.x);
        o.vx=Math.cos(ang)*2; o.vy=Math.sin(ang)*2;
      }
    }else if(o.type==='revenant'){
      if(Math.random()<0.06){
        let ang=Math.atan2(player.y-o.y,player.x-o.x);
        o.vx=Math.cos(ang)*2.5; o.vy=Math.sin(ang)*2.5;
      }
    }
    o.update();
  });

  handleCollisions();

  /* spawn logic */
  if(opponents.length<50) spawnOpponent();
}

/* ---------- collisions ---------- */
function handleCollisions(){
  /* vs pickups */
  pickups = pickups.filter(p=>{
    const d=Math.hypot(p.x-player.x,p.y-player.y);
    if(d<player.r+12){
      if(p.char==='R'){
        document.getElementById('radar').style.display='block';
      }
      return false;
    }
    return true;
  });

  /* vs opponents */
  opponents = opponents.filter(o=>{
    const d=Math.hypot(o.x-player.x,o.y-player.y);
    if(d<player.r+o.r){
      if(player.mass>o.mass){
        consume(o);
        return false;
      }else{
        // damage
        player.mass-=o.mass*0.1;
        return true;
      }
    }
    return true;
  });
}

function consume(o){
  player.mass+=o.mass*0.8;
  if(perfectFrenzy){
    const bonus=o.mass*frenzyTime; // <-- multiplier by secs left
    player.mass+=bonus;
  }
  /* type-specific effects */
  if(o.type==='spectre'){
    player.speed+=0.4;
    setTimeout(()=>player.speed=player.baseSpeed,4000);
    spectresEaten++;
    if(spectresEaten===6) unlockRevenants();
  }
}

function unlockRevenants(){
  spawnOpponent('revenant'); // drop one immediately
}

/* ---------- spawn opponents ---------- */
function spawnOpponent(forceType){
  const types=['circle','hoppy','spectre'];
  let t=forceType||types[Math.floor(rand(types.length))];
  if(t==='circle'){opponents.push(new Entity(rand(W*4)-W*2,rand(H*4)-H*2,8,10,'circle'));}
  if(t==='hoppy'){opponents.push(new Entity(rand(W*4)-W*2,rand(H*4)-H*2,12,18,'hoppy'));}
  if(t==='spectre'){opponents.push(new Entity(rand(W*4)-W*2,rand(H*4)-H*2,10,15,'spectre'));}
  if(t==='revenant'){opponents.push(new Entity(rand(W*4)-W*2,rand(H*4)-H*2,16,30,'revenant'));}
}

/* ---------- draw ---------- */
function draw(){
  ctx.save();
  ctx.translate(W/2-player.x,H/2-player.y);
  ctx.clearRect(player.x-W/2-50,player.y-H/2-50,W+100,H+100);

  /* background grid */
  ctx.strokeStyle='#333';
  ctx.lineWidth=1;
  for(let x=-2000;x<=2000;x+=100){
    ctx.beginPath();ctx.moveTo(x,-2000);ctx.lineTo(x,2000);ctx.stroke();
  }
  for(let y=-2000;y<=2000;y+=100){
    ctx.beginPath();ctx.moveTo(-2000,y);ctx.lineTo(2000,y);ctx.stroke();
  }

  /* pickups */
  pickups.forEach(p=>{
    ctx.fillStyle=`rgba(0,255,255,${0.6+0.4*Math.sin(Date.now()/200)})`;
    ctx.font='24px monospace';ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText(p.char,p.x,p.y);
  });

  opponents.forEach(o=>o.draw());

  /* player */
  ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,TWO_PI);
  ctx.fillStyle=player.color;ctx.fill();

  ctx.restore();

  /* UI */
  document.getElementById('score').textContent=`Mass ${player.mass|0}`;
  document.getElementById('frenzy').textContent=
    frenzyTime>0?`FRENZY ${frenzyTime.toFixed(1)}s`:'';
}

/* ---------- pause ---------- */
document.getElementById('pauseBtn').onclick=()=>{
  paused=!paused;
  document.getElementById('pauseBtn').textContent=paused?'Resume':'Pause';
};

</script>
</body>
</html>
