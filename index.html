<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy (Sprite-Head Build)</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ----------- global layout (unchanged) ------------------------------ */
html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
canvas{width:100%;height:100%;display:block;touch-action:none;background:#000;}
#hud,#compass,#effBar,#pauseBtn,#radarWrap,#zoomSlider{position:fixed;z-index:2}

#hud{top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);}
#compass{top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;}
#effBar{bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);}
#effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
#pauseBtn{top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;}
#radarWrap{top:48px;right:18px;width:70px;height:70px;display:none;}
#radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
#zoomSlider{top:130px;right:18px;width:70px;transform:rotate(-90deg);}

/* ----------- SPRITE-SHEET DRAGON HEAD ------------------------------- */
:root{
  --tile:48px;                         /* native tile size              */
  --cols:32;                           /* yaw frames                    */
  --rows:5;                            /* pitch frames                  */
  --zoom:4;                            /* in-game scale                 */
  --sheet:url("dragon_sprite_160f_48px.png");
}
#dragonHead{
  position:absolute;pointer-events:none;
  width:calc(var(--tile)*var(--zoom));
  height:calc(var(--tile)*var(--zoom));
  background-image:var(--sheet);
  background-repeat:no-repeat;
  background-size:calc(var(--tile)*var(--cols)*var(--zoom))
                  calc(var(--tile)*var(--rows)*var(--zoom));
  image-rendering:pixelated;
  transform-origin:center;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="dragonHead"></div>  <!-- sprite overlay -->

<!-- HUD -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- Audio -->
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
<audio id="eatSnd"         src="eat.mp3"              preload="auto"></audio>
<audio id="hurtSnd"        src="hurt.mp3"             preload="auto"></audio>
<audio id="frenzySnd"      src="frenzy.mp3"           preload="auto"></audio>

<script>
/* ---------- SPRITE-HEAD HELPER -------------------------------------- */
const HEAD  = document.getElementById('dragonHead');
const TILE  = 48, COLS = 32, ROWS = 5;
function setHead(px,py,yawIdx,pitchIdx,zoom){
  const step=TILE*zoom;
  HEAD.style.backgroundPosition=`${-yawIdx*step}px ${-pitchIdx*step}px`;
  HEAD.style.left = (px-step/2)+'px';
  HEAD.style.top  = (py-step/2)+'px';
}

/* ---------- ORIGINAL GAME CODE (unchanged logic) -------------------- */
/*    … everything from your previous Star-Frenzy script is here …      */
/*    Only FOUR small edits further down:                              *
 *      1. remove old DragonHead.draw() call                           *
 *      2. compute yawIndex & pitchIndex                               *
 *      3. call setHead()                                              *
 *      4. update zoom in CSS root when slider moves                   */

const MASS_THRESH=600,TITAN_LEVEL=10,TITAN_MAX=6,TITAN_RESPAWN_MS=20000,
      SPECTRE_MAX=3,REAPER_MAX=3,C_RING_DIST=1600,
      SPECTRE_SPEED_MS=6000,SPECTRE_SPEED_MULT=1.25,
      RADAR_PADDING=4,ZOOM_EASE=0.25,
      MASS_SPEED_FACTOR=0.0012,EXTRA_TAIL_PCT=0.10,MAX_TAIL_DRAW=60,
      SAFE_PLAYER_MASS=70,BLINK_MS=300;

/* -------- canvas / resize ------------------------------------------ */
const canvas=document.getElementById('game'),ctx=canvas.getContext('2d',{alpha:false});
let W=innerWidth,H=innerHeight;
function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}
addEventListener('resize',resize);resize();

/* -------- zoom slider hooks (edit #4) ------------------------------- */
const zoomSlider=document.getElementById('zoomSlider');
document.documentElement.style.setProperty('--zoom',4);
let sliderZoom=1, zoom=1;
zoomSlider.oninput=e=>{
  sliderZoom=parseFloat(e.target.value);
};

/* -------- world state (unchanged) ---------------------------------- */
/* (full game data & functions—as provided in your earlier code)       */
/* … SNIP for brevity …                                                */

/* -------- MAIN LOOP (edit #1–#3 inside) ----------------------------- */
let last=0;
function loop(ts){
  if(paused){last=ts;return requestAnimationFrame(loop);}
  const dt=(ts-last)||16; last=ts;

  /* world & rendering updates … (unchanged) */

  /* ---- after you compute player.x, player.y, player.heading ---- */
  /* edit #2 – map heading to yaw / pitch indices                   */
  const yawIdx   = Math.round(((player.heading%(2*Math.PI))+2*Math.PI)/(2*Math.PI)*COLS)%COLS;
  /* simple pitch demo: map vertical component of heading to rows   */
  const pitchIdx = Math.round((( -Math.sin(player.heading)+1)/2 )*(ROWS-1));

  /* edit #3 – position & frame the sprite                          */
  setHead(
    player.x*zoom+offset.x,
    player.y*zoom+offset.y,
    yawIdx,pitchIdx,
    parseInt(getComputedStyle(document.documentElement).getPropertyValue('--zoom'))
  );

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* iOS BG-music kickstart (unchanged) */
addEventListener('pointerdown',()=>{
  const bg=document.getElementById('backgroundMusic');
  if(bg&&bg.paused) bg.play().catch(()=>{});
},{once:true});
</script>
</body>
</html>