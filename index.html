<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution — Star-Frenzy (160-frame Sprite Head)</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
/* ---------- GLOBAL LAYOUT (unchanged) ------------------------------ */
html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
canvas{width:100%;height:100%;display:block;touch-action:none;background:#000;}
#hud,#compass,#effBar,#pauseBtn,#radarWrap,#zoomSlider{position:fixed;z-index:2}
#hud{top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);}
#compass{top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;}
#effBar{bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);}
#effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;}
#pauseBtn{top:14px;right:18px;font-size:22px;color:#fff;cursor:pointer;user-select:none;}
#radarWrap{top:48px;right:18px;width:70px;height:70px;display:none;}
#radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
#zoomSlider{top:130px;right:18px;width:70px;transform:rotate(-90deg);}

/* ---------- 160-FRAME SPRITE-SHEET HEAD ---------------------------- */
:root{
  --tile:48px;          /* native tile size in the sheet            */
  --cols:32;            /* yaw frames                               */
  --rows:5;             /* pitch frames                             */
  --scale:4;            /* in-game scale multiplier                 */
  --sheet:url("dragon_sprite_160f_48px.png");
}
#dragonHead{
  position:absolute;pointer-events:none;
  width:calc(var(--tile)*var(--scale));
  height:calc(var(--tile)*var(--scale));
  background-image:var(--sheet);
  background-repeat:no-repeat;
  background-size:calc(var(--tile)*var(--cols)*var(--scale))
                  calc(var(--tile)*var(--rows)*var(--scale));
  image-rendering:pixelated;
  transform-origin:center;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="dragonHead"></div>   <!-- sprite overlay -->

<!-- HUD -->
<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">⏸︎</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- Audio -->
<audio id="backgroundMusic" src="background-music.mp3" loop preload="auto"></audio>
<audio id="eatSnd"         src="eat.mp3"              preload="auto"></audio>
<audio id="hurtSnd"        src="hurt.mp3"             preload="auto"></audio>
<audio id="frenzySnd"      src="frenzy.mp3"           preload="auto"></audio>

<script>
/* ---------- SPRITE-HEAD HELPER ------------------------------------- */
const HEAD=document.getElementById('dragonHead');
const TILE=48,COLS=32,ROWS=5,SCALE=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--scale'));
function updateHead(screenX,screenY,yawIdx,pitchIdx,zoom){
  const size=TILE*SCALE*zoom;
  HEAD.style.width=HEAD.style.height=size+'px';
  HEAD.style.backgroundSize=(TILE*COLS*SCALE*zoom)+'px '+(TILE*ROWS*SCALE*zoom)+'px';
  HEAD.style.backgroundPosition=`${-yawIdx*size}px ${-pitchIdx*size}px`;
  HEAD.style.left=(screenX-size/2)+'px';
  HEAD.style.top =(screenY-size/2)+'px';
}

/* ------------------------------------------------------------------ *
 *   EVERYTHING BELOW THIS COMMENT IS **YOUR ORIGINAL GAME CODE**     *
 *   (constants, world setup, spawners, rendering, etc.)              *
 *   Only TWO tiny edits are made in the game loop near the bottom.   *
 * ------------------------------------------------------------------ */

/* … >>> paste your full original script from “const MASS_THRESH = …”  */
/*     all the way down to the main game loop. Nothing else changes.  */
/* ------------------------------------------------------------------ */

/* =========  MAIN LOOP (only EDITS are marked)  ===================== */
let last=0;
function loop(ts){
  if(paused){last=ts;return requestAnimationFrame(loop);}
  const dt=(ts-last)||16; last=ts;

  /* (unchanged update & render code …) */

  /* ---------- EDIT #1: compute yaw & pitch indices ---------------- */
  const yawIdx=Math.round(((player.heading%(2*Math.PI))+2*Math.PI)/(2*Math.PI)*COLS)%COLS;
  const pitchIdx=Math.round(((-Math.sin(player.heading)+1)/2)*(ROWS-1));

  /* ---------- EDIT #2: position the sprite head ------------------- */
  updateHead(
    player.x*zoom + offset.x,
    player.y*zoom + offset.y,
    yawIdx,pitchIdx,zoom
  );

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* iOS BG-music kickstart (unchanged) */
addEventListener('pointerdown',()=>{
  const bg=document.getElementById('backgroundMusic');
  if(bg&&bg.paused) bg.play().catch(()=>{});
},{once:true});
</script>
</body>
</html>